# STM32机器人小狗测试程序烧录指南

## 📋 概述

本指南将帮助您为STM32机器人小狗烧录测试程序，验证设备的各项功能。

## 🔧 准备工作

### 1. 硬件准备
- ✅ STM32F103机器人小狗设备
- ✅ USB数据线
- ✅ 电脑（Windows系统）
- ✅ 确保设备正常上电（LED指示灯亮起）

### 2. 软件工具安装

#### 选项A：STM32CubeIDE（推荐新手）
1. 访问 [STM32CubeIDE官网](https://www.st.com/en/development-tools/stm32cubeide.html)
2. 下载并安装最新版本
3. 包含了所有必要的编译和烧录工具

#### 选项B：独立工具链
1. **ARM GCC编译器**
   - 下载：[ARM GNU Toolchain](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)
   - 安装后确保添加到系统PATH

2. **烧录工具** (选择其一)
   - [STM32CubeProgrammer](https://www.st.com/en/development-tools/stm32cubeprog.html) (推荐)
   - [ST-Link Utility](https://www.st.com/en/development-tools/stsw-link004.html)

3. **Make工具**
   - Windows: 安装 [MinGW](https://www.mingw-w64.org/) 或 [MSYS2](https://www.msys2.org/)

## 🚀 快速开始

### 方法1：使用批处理文件（最简单）

1. 双击运行 `烧录测试程序.bat`
2. 选择 "1. 自动检测并烧录测试程序"
3. 等待自动完成

### 方法2：使用PowerShell脚本

```powershell
# 自动模式
.\flash_test.ps1

# 检查环境
.\flash_test.ps1 -Mode check

# 手动选择
.\flash_test.ps1 -Mode manual
```

### 方法3：手动命令行

```bash
# 编译测试程序
make -f Makefile.test test

# 烧录（根据您的工具选择）
make -f Makefile.test flash-cube    # STM32CubeProgrammer
make -f Makefile.test flash-test    # ST-Link
```

## 🔍 环境检查

在烧录前，建议先检查环境：

```powershell
.\flash_test.ps1 -Mode check
```

该命令会检查：
- ✅ USB设备连接状态
- ✅ 编译工具可用性
- ✅ 烧录工具安装情况

## 📱 测试程序功能

烧录成功后，机器人小狗将运行包含以下功能的测试程序：

### 🔄 自动测试模式
程序启动后会自动运行：
1. **OLED显示测试** - 验证屏幕显示功能
2. **舵机测试** - 逐个测试8个舵机的运动
3. **蓝牙通信测试** - 发送测试数据
4. **基础动作测试** - 执行各种预设动作
5. **表情显示测试** - 显示不同表情

### 🎮 交互控制模式
通过蓝牙发送以下命令：

| 命令 | 功能 | 说明 |
|------|------|------|
| `1` | 向前走 | 四腿协调向前运动 |
| `2` | 左转 | 原地左转 |
| `3` | 右转 | 原地右转 |
| `4` | 坐下 | 坐下姿势 |
| `5` | 站立 | 恢复站立姿势 |
| `6` | 跳舞 | 执行舞蹈动作 |
| `9` | 重新测试 | 重新运行自动测试 |

## 🔧 故障排除

### 问题1：未检测到设备
**症状**：设备管理器中无STM32设备
**解决方案**：
1. 检查USB线连接
2. 确认设备上电
3. 安装USB驱动程序
4. 尝试更换USB端口

### 问题2：编译失败
**症状**：make命令报错
**解决方案**：
1. 确认ARM GCC已安装
2. 检查PATH环境变量
3. 重新安装编译工具链

### 问题3：烧录失败
**症状**：Flash命令执行失败
**解决方案**：
1. 确认烧录工具已安装
2. 检查设备连接状态
3. 尝试不同的烧录工具
4. 检查BOOT引脚设置（如使用串口烧录）

### 问题4：程序无响应
**症状**：烧录成功但设备无反应
**解决方案**：
1. 检查OLED屏幕显示
2. 尝试蓝牙连接
3. 重新上电设备
4. 检查舵机连接

## 📞 蓝牙连接设置

1. **配对设备**
   - 打开电脑蓝牙设置
   - 搜索并连接机器狗蓝牙设备

2. **串口通信**
   - 使用串口终端工具（如PuTTY、Arduino IDE串口监视器）
   - 波特率：9600
   - 数据位：8，停止位：1，无校验

3. **测试连接**
   - 发送命令 `1` 测试向前走
   - 观察机器狗是否响应

## 🎯 验收标准

测试程序正常运行的标志：
- ✅ OLED屏幕显示测试信息
- ✅ 舵机能够正常运动
- ✅ 蓝牙可以接收和响应命令
- ✅ 各种动作能够正常执行
- ✅ 表情能够正常显示

## 📝 下一步

测试程序验证成功后，您可以：
1. 基于测试程序修改功能
2. 开发自定义动作序列
3. 集成更多传感器功能
4. 实现高级AI交互功能

## 📞 技术支持

如遇到问题，请检查：
1. 项目的 `docs/development_guide.md`
2. 厂商参考资料文件夹
3. 项目的README.md文件

---

**祝您使用愉快！🐕**
